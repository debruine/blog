---
title: LMER vs ANOVA
author: ~
date: "2019-01-10"
slug: lmer-vs-anova
categories: ["rstats"]
tags: ["R", "simulation", "lmer", "lme4", "anova"]
draft: true
---



<p>This tutorial will walk you through generating a dataset using a function modified from [Simulating Random Slopes][simulating-random-slopes] and comparing the output of a mixed effects model with the output of ANOVAs run on the data aggregated by subjects or by stimuli. We’ll use the <code>afex</code> package to run our ANOVAs.</p>
<pre class="r"><code>library(tidyverse)
library(lmerTest)
library(afex)
library(faux)
options(&quot;scipen&quot;=10, &quot;digits&quot;=4)
set.seed(8675309) # Jenny, I&#39;ve got your number</code></pre>
<div id="functions" class="section level2">
<h2>Functions</h2>
<div id="generate-data" class="section level3">
<h3>Generate Data</h3>
<p>This function is just the dataset generating code from the function in [Simulating Random Slopes][simulating-random-slopes]. It returns a data frame with the specified properties. The defaults of this function are set to default to null effects, with all intecept/slope correlations set to ±0.2 and all intercept and slope SDs set to 50.</p>
<pre class="r"><code>sim_dat  &lt;- function( sub_n = 100,
                      sub_sd = 50,
                      sub_version_sd = 50, 
                      sub_i_version_cor = -0.2,
                      stim_n = 50,
                      stim_sd = 50,
                      stim_version_sd = 50,
                      stim_cond_sd = 50,
                      stim_cond_version_sd = 50,
                      stim_i_cor = -0.2,
                      stim_s_cor = +0.2,
                      grand_i = 400,
                      hard_congr = 0,
                      hard_incon = 0,
                      easy_congr = 0,
                      easy_incon = 0,
                      error_sd = 50) {
  sub &lt;- rnorm_multi(
    n = sub_n, 
    vars = 2, 
    cors = sub_i_version_cor,
    mu = 0, # means of random intercepts and slopes are always 0
    sd = c(sub_sd, sub_version_sd),
    varnames = c(&quot;sub_i&quot;, &quot;sub_version_slope&quot;)
  ) %&gt;%
    mutate(
      sub_id = 1:sub_n,
      sub_cond = rep(c(&quot;easy&quot;,&quot;hard&quot;), each = sub_n/2) # between-subjects factor
    )
  
  stim_cors &lt;- c(stim_i_cor, stim_i_cor, stim_i_cor,
                             stim_s_cor, stim_s_cor,
                                         stim_s_cor)
  stim &lt;- rnorm_multi(
    n = stim_n, 
    vars = 4, 
    cors = stim_cors, 
    mu = 0, # means of random intercepts and slopes are always 0
    sd = c(stim_sd, stim_version_sd, stim_cond_sd, stim_cond_version_sd),
    varnames = c(&quot;stim_i&quot;, &quot;stim_version_slope&quot;, &quot;stim_cond_slope&quot;, &quot;stim_cond_version_slope&quot;)
  ) %&gt;%
    mutate(
      stim_id = 1:stim_n
    )
  
  # mean difference between easy and hard conditions
  sub_cond_eff     &lt;- (easy_congr + easy_incon)/2 -
                      (hard_congr + hard_incon)/2
  # mean difference between incongruent and congruent versions
  stim_version_eff &lt;- (hard_incon + easy_incon)/2 - 
                      (hard_congr + easy_congr)/2  
  # interaction between version and condition
  cond_version_ixn &lt;- (easy_incon - easy_congr) -
                      (hard_incon - hard_congr) 
  
  trials &lt;- expand.grid(
    sub_id = sub$sub_id, # get subject IDs from the sub data table
    stim_id = stim$stim_id, # get stimulus IDs from the stim data table
    stim_version = c(&quot;congruent&quot;, &quot;incongruent&quot;) # all subjects see both congruent and incongruent versions of all stimuli
  ) %&gt;%
    left_join(sub, by = &quot;sub_id&quot;) %&gt;% # includes the intercept, slope, and conditin for each subject
    left_join(stim, by = &quot;stim_id&quot;)   # includes the intercept and slopes for each stimulus
  
  dat &lt;- trials %&gt;%
    mutate(
      # effect-code subject condition and stimulus version
      sub_cond.e = recode(sub_cond, &quot;hard&quot; = -0.5, &quot;easy&quot; = +0.5),
      stim_version.e = recode(stim_version, &quot;congruent&quot; = -0.5, &quot;incongruent&quot; = +0.5),
      # calculate trial-specific effects by adding overall effects and slopes
      version_eff = stim_version_eff + stim_version_slope + sub_version_slope,
      cond_eff = sub_cond_eff + stim_cond_slope,
      cond_version_eff = cond_version_ixn + stim_cond_version_slope,
      # calculate error term (normally distributed residual with SD set above)
      err = rnorm(nrow(.), 0, error_sd),
      # calculate DV from intercepts, effects, and error
      dv = grand_i + sub_i + stim_i + err +
           (sub_cond.e * cond_eff) + 
           (stim_version.e * version_eff) + 
           (sub_cond.e * stim_version.e * cond_version_eff)
    )
  return(dat)
}</code></pre>
</div>
<div id="linear-mixed-effects-regression" class="section level3">
<h3>Linear Mixed Effects Regression</h3>
<p>The <code>sim_lmer</code> function takes a dataset generated by <code>sim_dat</code> and returns the summary output of a maximally specified linear mixed effects regression.</p>
<pre class="r"><code>sim_lmer &lt;- function(dat) {
  mod &lt;- lmer(dv ~ sub_cond.e * stim_version.e +
                (1 + stim_version.e | sub_id) + 
                (1 + stim_version.e*sub_cond.e | stim_id),
              data = dat)
  
  mod.sum &lt;- summary(mod)
  
  return(mod.sum)
}</code></pre>
</div>
<div id="by-subject-anova" class="section level3">
<h3>By-Subject ANOVA</h3>
<p>The <code>sim_sub_anova</code> function takes a dataset generated by <code>sim_dat</code>, groups the data by subject ID and stimulus version, averages the DV to produce one score for congruent and one score for incongruent stimuli for each subject, and returns the summary output of an ANOVA with the between-subjects factor of <code>condition</code> and the within-subjects factor of <code>version</code>.</p>
<pre class="r"><code>sim_sub_anova &lt;- function(dat) {
  dat_sub &lt;- dat %&gt;%
    group_by(sub_id, sub_cond, sub_cond.e, stim_version, stim_version.e) %&gt;%
    summarise(dv = mean(dv))
  
  mod &lt;- afex::aov_4(dv ~ sub_cond.e + (stim_version.e| sub_id),
                     factorize = FALSE, check_contrasts = FALSE,
                     data = dat_sub)
  
  mod.sum &lt;- anova(mod)
  
  return(mod.sum)
}</code></pre>
</div>
<div id="by-stimulus-anova" class="section level3">
<h3>By-Stimulus ANOVA</h3>
<p>The <code>sim_stim_anova</code> function takes a dataset generated by <code>sim_dat</code>, groups the data by stimulus ID and subject condition, averages the DV to produce four scores for each stimulus (hard congruent, easy congruent, hard incongruent, and easy incongruent), and returns the summary output of an ANOVA with the within-stimulus factor of <code>condition</code> and the within-stimulus factor of <code>version</code>.</p>
<pre class="r"><code>sim_stim_anova &lt;- function(dat) {
  dat_stim &lt;- dat %&gt;%
    group_by(stim_id, sub_cond, sub_cond.e, stim_version, stim_version.e) %&gt;%
    summarise(dv = mean(dv))
  
  mod &lt;- afex::aov_4(dv ~ (sub_cond.e * stim_version.e | stim_id),
                     factorize = FALSE, check_contrasts = FALSE,
                     data = dat_stim)
  
  mod.sum &lt;- anova(mod)
  
  return(mod.sum)
}</code></pre>
</div>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>In this example, 50 subjects view 20 stimuli. There is a main effect of version (incongruent &gt; congruent), no effect of condition (easy == hard), and an interaction between sondition and version (the effect of version is larger for the easy condition than the hard condition). I’ve increased <code>error_sd</code> to 100.</p>
<pre class="r"><code>dat &lt;- sim_dat(sub_n = 50,
               stim_n = 20,
               hard_congr = -10,
               hard_incon = +10,
               easy_congr = -20,
               easy_incon = +20,
               error_sd = 100)</code></pre>
<pre class="r"><code>sim_lmer(dat)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0123831
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: 
## dv ~ sub_cond.e * stim_version.e + (1 + stim_version.e | sub_id) +  
##     (1 + stim_version.e * sub_cond.e | stim_id)
##    Data: dat
## 
## REML criterion at convergence: 24515
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
## -3.963 -0.669  0.003  0.659  3.607 
## 
## Random effects:
##  Groups   Name                      Variance Std.Dev. Corr             
##  sub_id   (Intercept)                1873     43.3                     
##           stim_version.e             1745     41.8    -0.19            
##  stim_id  (Intercept)                1741     41.7                     
##           stim_version.e             2741     52.4    -0.51            
##           sub_cond.e                 1442     38.0    -0.26 -0.27      
##           stim_version.e:sub_cond.e  3708     60.9    -0.57  0.38 -0.26
##  Residual                           10900    104.4                     
## Number of obs: 2000, groups:  sub_id, 50; stim_id, 20
## 
## Fixed effects:
##                           Estimate Std. Error     df t value Pr(&gt;|t|)    
## (Intercept)                 399.84      11.40  34.56   35.07  &lt; 2e-16 ***
## sub_cond.e                    5.75      15.61  55.09    0.37  0.71411    
## stim_version.e               51.99      13.92  26.92    3.73  0.00089 ***
## sub_cond.e:stim_version.e    46.99      20.30  34.08    2.31  0.02679 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) sb_cn. stm_v.
## sub_cond.e  -0.117              
## stim_versn. -0.393 -0.123       
## sb_cnd.:s_. -0.310 -0.183  0.212
## convergence code: 0
## Model failed to converge with max|grad| = 0.0123831 (tol = 0.002, component 1)</code></pre>
<pre class="r"><code>sim_sub_anova(dat)</code></pre>
<pre><code>## Anova Table (Type 3 tests)
## 
## Response: dv
##                           num Df den Df  MSE     F    ges     Pr(&gt;F)    
## sub_cond.e                     1     48 4292  0.19 0.0030     0.6628    
## stim_version.e                 1     48 1417 47.67 0.1978 0.00000001 ***
## sub_cond.e:stim_version.e      1     48 1417  9.74 0.0479     0.0031 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>sim_stim_anova(dat)</code></pre>
<pre><code>## Anova Table (Type 3 tests)
## 
## Response: dv
##                           num Df den Df  MSE     F    ges  Pr(&gt;F)    
## sub_cond.e                     1     19 1876  0.35 0.0025 0.55981    
## stim_version.e                 1     19 3178 17.01 0.1707 0.00058 ***
## sub_cond.e:stim_version.e      1     19 1364  8.10 0.0403 0.01035 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>sim_power &lt;- function(rep = 0) {
  dat &lt;- sim_dat(
    sub_n = 50,
    stim_n = 20,
    hard_congr = -10,
    hard_incon = +10,
    easy_congr = -20,
    easy_incon = +20,
    error_sd = 100
  )
  
  mod.lmer &lt;- sim_lmer(dat)
  mod.sub &lt;- sim_sub_anova(dat)
  mod.stim &lt;- sim_stim_anova(dat)
  

  table.lmer &lt;- mod.lmer$coefficients %&gt;%
    as_tibble(rownames = &quot;effect&quot;) %&gt;%
    select(effect, es = Estimate, p = 6) %&gt;%
    mutate(analysis = &quot;lmer&quot;)
  
  table.sub &lt;- mod.sub %&gt;%
    as_tibble(rownames = &quot;effect&quot;) %&gt;%
    select(effect, es = ges, p = 7) %&gt;%
    mutate(analysis = &quot;anova_sub&quot;)
  
  table.stim &lt;- mod.stim %&gt;%
    as_tibble(rownames = &quot;effect&quot;) %&gt;%
    select(effect, es = ges, p = 7) %&gt;%
    mutate(analysis = &quot;anova_stim&quot;)

  bind_rows(table.lmer, table.sub, table.stim) %&gt;%
    mutate(rep = rep)
}</code></pre>
<p>Now we run the function above 100 times. This will take a few minutes; be patient.</p>
<pre class="r"><code>power &lt;- purrr::map_df(1:100, sim_power)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0120184
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0071441
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00314142
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0209817
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00772643
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00261073
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00685615
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0025197
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00377539
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00201652
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00411528
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00377495
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0120067
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00272377
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00306834
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00442865
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00339446
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0224845
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0048228
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00388736
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00405376
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00577476
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00296717
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00310845
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00415021
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00636408
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0164785
## (tol = 0.002, component 1)</code></pre>
<pre><code>## singular fit</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0123927
## (tol = 0.002, component 1)</code></pre>
<pre><code>## singular fit</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00354329
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00325491
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00348639
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00321174
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00370857
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00254257
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00607368
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0058884
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00423176
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00707 (tol
## = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.01691 (tol
## = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00330094
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0245628
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00347818
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00262562
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00393768
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00364925
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00423784
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00327692
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00559927
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00204392
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00263456
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00838414
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00285205
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00280015
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00305579
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : unable to evaluate scaled gradient</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge: degenerate Hessian with 1
## negative eigenvalues</code></pre>
<pre><code>## Warning: Model failed to converge with 1 negative eigenvalue: -2.0e+01</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00550065
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00469551
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00243974
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00409686
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00629647
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00929932
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0145664
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00284092
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0558017
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00904202
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00514166
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0117226
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00432724
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00662406
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00404937
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00351066
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0111862
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00617999
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0217362
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00311689
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00724168
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00619442
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00245089
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00481601
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00237761
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0189972
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00214594
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00277506
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00629518
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00354149
## (tol = 0.002, component 1)</code></pre>
<pre><code>## singular fit</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.0476245
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00642246
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00419661
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00825195
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00227382
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00546282
## (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 0.00319947
## (tol = 0.002, component 1)</code></pre>
<p>Here is a plot of the distribution of p-values for the three types of analysis.</p>
<pre class="r"><code>power %&gt;%
  filter(effect != &quot;(Intercept)&quot;) %&gt;%
  ggplot(aes(p, fill = analysis, color = analysis)) +
  geom_density(alpha = 0.1) +
  facet_grid(effect~., scales = &quot;free_y&quot;)</code></pre>
<p><img src="/drafts/lmer_vs_anova_files/figure-html/plot-power-p-1.png" width="960" /></p>
<pre class="r"><code>power %&gt;%
  filter(effect != &quot;(Intercept)&quot;, analysis != &quot;lmer&quot;) %&gt;%
  group_by(analysis, effect) %&gt;%
  mutate(mean_es = mean(es)) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(es, fill = analysis, color = analysis)) +
  geom_density(alpha = 0.1) +
  geom_vline(aes(xintercept = mean_es, color = analysis)) +
  facet_grid(effect~., scales = &quot;free_y&quot;)</code></pre>
<p><img src="/drafts/lmer_vs_anova_files/figure-html/plot-es-anova-1.png" width="960" /></p>
<pre class="r"><code>power %&gt;%
  filter(effect != &quot;(Intercept)&quot;, analysis == &quot;lmer&quot;) %&gt;%
  group_by(analysis, effect) %&gt;%
  mutate(mean_es = mean(es)) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(es, fill = analysis, color = analysis)) +
  geom_density(alpha = 0.1) +
  geom_vline(aes(xintercept = mean_es, color = analysis)) +
  facet_grid(effect~., scales = &quot;free_y&quot;)</code></pre>
<p><img src="/drafts/lmer_vs_anova_files/figure-html/plot-es-lmer-1.png" width="960" /></p>
</div>
